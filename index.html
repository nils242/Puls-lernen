<!DOCTYPE html>
<html>
  <head>
    <title>Pulsmessung üben</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <link rel="stylesheet" href="app.min.css">
  </head>
		    
<script>	   
var isAppForeground = true;
    
    function initAds() {
      if (admob) {
        var adPublisherIds = {
          android : {
            banner : "ca-app-pub-3599258879952390~4630651065",
          }
        };
    	  
        var admobid = (/(android)/i.test(navigator.userAgent)) ? adPublisherIds.android : adPublisherIds.ios;
            
        admob.setOptions({
          publisherId:       pub-3599258879952390   
        });
 
        registerAdEvents();
        
      } else {
        alert('AdMobAds plugin not ready');
      }
    }
    
    function onAdLoaded(e) {
      if (isAppForeground) {
        if (e.adType === admob.AD_TYPE.INTERSTITIAL) {
          console.log("An interstitial has been loaded and autoshown. If you want to load the interstitial first and show it later, set 'autoShowInterstitial: false' in admob.setOptions() and call 'admob.showInterstitialAd();' here");
        } else if (e.adType === admob.AD_TYPE_BANNER) {
          console.log("New banner received");
        }
      }
    }
    
    function onPause() {
      if (isAppForeground) {
        admob.destroyBannerView();
        isAppForeground = false;
      }
    }
    
    function onResume() {
      if (!isAppForeground) {
        setTimeout(admob.createBannerView, 1);
        setTimeout(admob.requestInterstitialAd, 1);
        isAppForeground = true;
      }
    }
    
    // optional, in case respond to events 
    function registerAdEvents() {
      document.addEventListener(admob.events.onAdLoaded, onAdLoaded);
      document.addEventListener(admob.events.onAdFailedToLoad, function (e) {});
      document.addEventListener(admob.events.onAdOpened, function (e) {});
      document.addEventListener(admob.events.onAdClosed, function (e) {});
      document.addEventListener(admob.events.onAdLeftApplication, function (e) {});
      document.addEventListener(admob.events.onInAppPurchaseRequested, function (e) {});
      
      document.addEventListener("pause", onPause, false);
      document.addEventListener("resume", onResume, false);
    }
        
    function onDeviceReady() {
      document.removeEventListener('deviceready', onDeviceReady, false);
      initAds();
 
      // display a banner at startup 
      admob.createBannerView();
    }
    
    document.addEventListener("deviceready", onDeviceReady, false);
	</script>
  <body>
    <div class="app-page" data-page="home">
      <div class="app-topbar">
        <div class="app-title">Pulsmessung üben</div>
      </div>
      <div class="app-content">
        <div class="app-section" style="color:darkgrey;">
          <div class="app-button green" id="startbutton" style="color:black;">Start</div></div>
        <div class="app-section" style="color:darkgrey;">
          <div class="app-button red" id="stopbutton" style="color:black;">Stop</div></div>
<div class="app-section">	      
<div class="feld1" align="center" style="font-weight:bold">Drücken Sie "Start"</div>
<div class="feld2" align="center">und messen Sie Pulsfrequenz und -rhythmus anhand der Vibration des Smartphones</div>
<div class="feld3" align="center">  </div>	
<div class="feld4" align="center">  </div>
<div id="replaybutton" style="color:black;"></div></div>	      
	     
<div class="app-section"><div class="app-button" href="http://www.nilswommelsdorf.de" style="height:100px;color:black;" align="center" id="weblink"><img src="schrift.png"><div>V 1.0 | www.nilswommelsdorf.de | 2017</div> 
	      </div></div>

   <script src="zepto.js"></script>
    <script src="app.min.js"></script>
    <script>
App.controller('home', function (page) {
ruready = 1
function pulsfrequenz()
{
var pfmin = 45;
var pfmax = 110;
pf = Math.floor(Math.random() * (pfmax - pfmin + 1)) + pfmin;
if (pf >= 100){
   pfrequenz = "Tachykardie (> 100 1/min)";
}
else if (pf <= 60){
   pfrequenz = "Bradykardie (< 60 1/min)";
}
else if (pf > 60 && pf < 80){
   pfrequenz = "Normokardie (60 - 80 1/min)";
}
else {
   pfrequenz = "";
}
Number( pf )  
pattquot = Math.round((60000 - (60 * pf)) / pf);
};
function pulspattern()
{
var pattmin = 1;
var pattmax = 6;
patt = Math.floor(Math.random() * (pattmax - pattmin + 1)) + pattmin;
if (patt == 1) {
prhythmus = "Extrasystole (ohne kompensatorische Pause)"
pascii = "|.....|.....|..I...|.....|.....|....."
pattquotb = Math.round((pattquot - 40) / 1.8);
pattquotc = Math.round((pattquot - 40) / 2.25);  
vibrpattern = [60, pattquot, 60, pattquot, 60, pattquot, 60, pattquotb, 40, pattquotc, 60, pattquot, 60, pattquot, 60, pattquot];
patternlength = 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquotb + 40 + pattquotc + 60 + pattquot + 60 + pattquot + 60 + pattquot
}
else if (patt == 2) {
prhythmus = "Extrasystole (mit kompensatorischer Pause)"
pascii = "|.....|.....|..I.........|.....|....."	
pattquotb = Math.round((pattquot - 40) / 1.8);
pattquotc = Math.round((pattquot - 40) / 2.25);
pattquotd = Math.round(pattquot + pattquotc);  
vibrpattern = [60, pattquot, 60, pattquot, 60, pattquot, 60, pattquot, 60, pattquot, 60, pattquotb, 40, pattquotd, 60, pattquot];
patternlength = 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquotb + 40 + pattquotd + 60 + pattquot
}
else if (patt == 3) {
prhythmus = "Pulsus Bigeminus"
pascii = "|.I....|.I....|.I....|.I....|.I....|.I...."	
pattquote = Math.round((pattquot - 40) / 4.5);
pattquotf = Math.round((pattquot - 40) / 1.2857142857142); 
vibrpattern = [60, pattquote, 40, pattquotf, 60, pattquote, 40, pattquotf, 60, pattquote, 40, pattquotf, 60, pattquote, 40, pattquotf];
patternlength = 60 + pattquote + 40 + pattquotf + 60 + pattquote + 40 + pattquotf + 60 + pattquote + 40 + pattquotf + 60 + pattquote + 40 + pattquotf
}
else if (patt == 4) {
prhythmus = "Arrhythmie"
pascii = "|..|.....|....|..|.......|....|.|...."	
pattquotb = Math.round((pattquot - 40) / 1.8);
pattquotc = Math.round((pattquot - 40) / 2.25);
pattquotd = Math.round(pattquot + pattquotc); 	
pattquote = Math.round((pattquot - 40) / 4.5);
pattquotf = Math.round((pattquot - 40) / 1.2857142857142);
	if (pf >= 90){
vibrpattern = [60, pattquote, 40, pattquotf, 60, pattquot, 60, pattquot, 60, pattquotb, 40, pattquotd, 60, pattquot, 60, pattquotb, 40, pattquotc, 60, pattquotb, 40, pattquotd, 60, pattquote, 40, pattquot];     
patternlength = 60 + pattquote + 40 + pattquotf + 60 + pattquot + 60 + pattquot + 60 + pattquotb + 40 + pattquotd + 60 + pattquot + 60 + pattquotb + 40 + pattquotc + 60, pattquotb + 40 + pattquotd + 60 + pattquote + 40 + pattquotf
}
else{
vibrpattern = [60, pattquote, 40, pattquotf, 60, pattquot, 60, pattquot, 60, pattquotb, 40, pattquotd, 60, pattquot, 60, pattquotb, 40, pattquotc];     
patternlength = 60 + pattquote + 40 + pattquotf + 60 + pattquot + 60 + pattquot + 60 + pattquotb + 40 + pattquotd + 60 + pattquot + 60 + pattquotb + 40 + pattquotc
}}
else {
prhythmus = "Ruhepuls (Sinusrhythmus)"
pascii = "|.....|.....|.....|.....|.....|....."	
vibrpattern = [60, pattquot, 60, pattquot, 60, pattquot, 60, pattquot, 60, pattquot, 60, pattquot, 60, pattquot, 60, pattquot];
patternlength = 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquot
}    
};
 
		function startVibrate(level) {
			navigator.vibrate(level);
		}
		var vibrateInterval;
		function startPeristentVibrate(level, interval) {
			vibrateInterval = setInterval(function() {
				startVibrate(level);
			}, interval);
		}
		
		function stopVibrate() {
			if(vibrateInterval) clearInterval(vibrateInterval);
			navigator.vibrate([]);
		}  		
	
  $(page)
    .find('#startbutton')
    .on('click', function () {
if (ruready == 1) {
   $(page).find('#replaybutton').removeClass('app-button').text(''); 		
	alert("startbt läuft!");
pulsfrequenz()
pulspattern()
startPeristentVibrate(vibrpattern, patternlength);
   $(page).find('.feld1').text(" ");
   $(page).find('.feld2').text("... Pulsübung startet ...");
   $(page).find('.feld3').text(" ");
   $(page).find('.feld4').text(" ");
ruready = 0
}
else {
	return false}
   });
	
	
  $(page)
    .find('#stopbutton')
    .on('click', function () {
ruready = 1;	  
stopVibrate();
   $(page).find('.feld1').text('Pulsfrequenz: ' + pf + ' 1/min');
   $(page).find('.feld2').text('' + pfrequenz + '');  
   $(page).find('.feld3').text('Pulsrhythmus: ' + prhythmus + '').css('font-weight', 'bold');
   $(page).find('.feld4').text('' + pascii + '');
   $(page).find('.feld4').text('' + pascii + '');	  
   $(page).find('#replaybutton').addClass('app-button blue').text('Noch einmal abspielen?'); 
   });
	
  $(page)
    .find('#replaybutton')
    .on('click', function () {
if (ruready == 1) {	  
	  	alert("replaybt läuft!");
startPeristentVibrate(vibrpattern, patternlength);
ruready = 2
}
else {
	return false}	
   });	
	    
$(page)
    .find('#weblink')
    .on('click', function () {

        window.open($(this).attr("href"))
});
	   });
      try {
        App.restore();
      } catch (err) {
        App.load('home');
      }
	    
	     
    </script>
  </body>
</html>
