<!DOCTYPE html>
<html>
  <head>
    <title>Pulsmessung 端ben</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <link rel="stylesheet" href="app.min.css">
  </head>
		
    <body onload="onDocLoad()" onresize="onResize()">
    <script>
    function onDocLoad() {

        if(( /(ipad|iphone|ipod|android|windows phone)/i.test(navigator.userAgent) )) {
            document.addEventListener('deviceready', initApp, false);
        } else {
	             initApp();  
        }
    }
    
    function initApp() {
        initAd();
        // display the banner at startup
        window.plugins.AdMob.createBannerView();
    }
    function initAd(){
        if ( window.plugins && window.plugins.AdMob ) {
			    alert('loaded!');
    	    var ad_units = {
				ios : {
				},
				android : {
					banner: 'ca-app-pub-3599258879952390~4630651065'
				},
				wp8 : {

				}
    	    };
    	    var admobid = "";
    	    if( /(android)/i.test(navigator.userAgent) ) {
    	    	admobid = ad_units.android;
    	    } else if(/(iphone|ipad)/i.test(navigator.userAgent)) {
    	    	admobid = ad_units.ios;
    	    } else {
    	    	admobid = ad_units.wp8;
    	    }
            window.plugins.AdMob.setOptions( {
                publisherId: admobid.banner,
                interstitialAdId: admobid.interstitial,
                bannerAtTop: false, // set to true, to put banner at top
                overlap: false, // set to true, to allow banner overlap webview
                offsetTopBar: false, // set to true to avoid ios7 status bar overlap
                isTesting: true, // receiving test ad
                autoShow: true // auto show interstitial ad when loaded
            });
            registerAdEvents();
            
        } else {
            alert( 'admob plugin not ready' );
        }
    }
	// optional, in case respond to events
    function registerAdEvents() {
    	document.addEventListener('onReceiveAd', function(){});
        document.addEventListener('onFailedToReceiveAd', function(data){});
        document.addEventListener('onPresentAd', function(){});
        document.addEventListener('onDismissAd', function(){ });
        document.addEventListener('onLeaveToAd', function(){ });
        document.addEventListener('onReceiveInterstitialAd', function(){ });
        document.addEventListener('onPresentInterstitialAd', function(){ });
        document.addEventListener('onDismissInterstitialAd', function(){ });
    }
    function onResize() {
        var msg = 'web view: ' + window.innerWidth + ' x ' + window.innerHeight;
        document.getElementById('sizeinfo').innerHTML = msg;
    }
    </script>
    <div class="app-page" data-page="home">
      <div class="app-topbar">
        <div class="app-title">Pulsmessung 端ben</div>
      </div>
      <div class="app-content">
        <div class="app-section" style="color:darkgrey;">
          <div class="app-button green" id="startbutton" style="color:black;">Start</div></div>
        <div class="app-section" style="color:darkgrey;">
          <div class="app-button red" id="stopbutton" style="color:black;">Stop</div></div>
<div class="app-section">	      
<div class="feld1" align="center" style="font-weight:bold">Dr端cken Sie "Start"</div>
<div class="feld2" align="center">und messen Sie Pulsfrequenz und Pulsrhythmus anhand der Vibration Ihres Smartphones</div>
<div class="feld3" align="center">  </div>	
<div class="feld4" align="center">  </div>
<div id="replaybutton" style="color:black;"></div></div>	      
	     
<div class="app-section"><div class="app-button" href="http://www.nilswommelsdorf.de" style="height:100px;color:black;" align="center" id="weblink"><img src="schrift.png"><div>V 1.0 | www.nilswommelsdorf.de | 2017</div> 
	      </div></div>

   <script src="zepto.js"></script>
    <script src="app.min.js"></script>
    <script>
App.controller('home', function (page) {

ruready = 1
function pulsfrequenz()
{
var pfmin = 45;
var pfmax = 110;
pf = Math.floor(Math.random() * (pfmax - pfmin + 1)) + pfmin;
if (pf >= 100){
   pfrequenz = "Tachykardie (> 100 1/min)";
}
else if (pf <= 60){
   pfrequenz = "Bradykardie (< 60 1/min)";
}
else if (pf > 60 && pf < 80){
   pfrequenz = "Normokardie (60 - 80 1/min)";
}
else {
   pfrequenz = "";
}
Number( pf )  
pattquot = Math.round((60000 - (60 * pf)) / pf);
};
function pulspattern()
{
var pattmin = 1;
var pattmax = 6;
patt = Math.floor(Math.random() * (pattmax - pattmin + 1)) + pattmin;
if (patt == 1) {
prhythmus = "Extrasystole (ohne kompensatorische Pause)"
pascii = "|.....|.....|..I...|.....|.....|....."
pattquotb = Math.round((pattquot - 40) / 1.8);
pattquotc = Math.round((pattquot - 40) / 2.25);  
vibrpattern = [60, pattquot, 60, pattquot, 60, pattquot, 60, pattquotb, 40, pattquotc, 60, pattquot, 60, pattquot, 60, pattquot];
patternlength = 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquotb + 40 + pattquotc + 60 + pattquot + 60 + pattquot + 60 + pattquot
}
else if (patt == 2) {
prhythmus = "Extrasystole (mit kompensatorischer Pause)"
pascii = "|.....|.....|..I.........|.....|....."	
pattquotb = Math.round((pattquot - 40) / 1.8);
pattquotc = Math.round((pattquot - 40) / 2.25);
pattquotd = Math.round(pattquot + pattquotc);  
vibrpattern = [60, pattquot, 60, pattquot, 60, pattquot, 60, pattquot, 60, pattquot, 60, pattquotb, 40, pattquotd, 60, pattquot];
patternlength = 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquotb + 40 + pattquotd + 60 + pattquot
}
else if (patt == 3) {
prhythmus = "Pulsus Bigeminus"
pascii = "|.I....|.I....|.I....|.I....|.I....|.I...."	
pattquote = Math.round((pattquot - 40) / 4.5);
pattquotf = Math.round((pattquot - 40) / 1.2857142857142); 
vibrpattern = [60, pattquote, 40, pattquotf, 60, pattquote, 40, pattquotf, 60, pattquote, 40, pattquotf, 60, pattquote, 40, pattquotf];
patternlength = 60 + pattquote + 40 + pattquotf + 60 + pattquote + 40 + pattquotf + 60 + pattquote + 40 + pattquotf + 60 + pattquote + 40 + pattquotf
}
else if (patt == 4) {
prhythmus = "Arrhythmie"
pascii = "|..|.....|....|..|.......|....|.|...."	
pattquotb = Math.round((pattquot - 40) / 1.8);
pattquotc = Math.round((pattquot - 40) / 2.25);
pattquotd = Math.round(pattquot + pattquotc); 	
pattquote = Math.round((pattquot - 40) / 4.5);
pattquotf = Math.round((pattquot - 40) / 1.2857142857142);
	if (pf >= 90){
vibrpattern = [60, pattquote, 40, pattquotf, 60, pattquot, 60, pattquot, 60, pattquotb, 40, pattquotd, 60, pattquot, 60, pattquotb, 40, pattquotc, 60, pattquotb, 40, pattquotd, 60, pattquote, 40, pattquot];     
patternlength = 60 + pattquote + 40 + pattquotf + 60 + pattquot + 60 + pattquot + 60 + pattquotb + 40 + pattquotd + 60 + pattquot + 60 + pattquotb + 40 + pattquotc + 60, pattquotb + 40 + pattquotd + 60 + pattquote + 40 + pattquotf
}
else{
vibrpattern = [60, pattquote, 40, pattquotf, 60, pattquot, 60, pattquot, 60, pattquotb, 40, pattquotd, 60, pattquot, 60, pattquotb, 40, pattquotc];     
patternlength = 60 + pattquote + 40 + pattquotf + 60 + pattquot + 60 + pattquot + 60 + pattquotb + 40 + pattquotd + 60 + pattquot + 60 + pattquotb + 40 + pattquotc
}}
else {
prhythmus = "Ruhepuls (Sinusrhythmus)"
pascii = "|.....|.....|.....|.....|.....|....."	
vibrpattern = [60, pattquot, 60, pattquot, 60, pattquot, 60, pattquot, 60, pattquot, 60, pattquot, 60, pattquot, 60, pattquot];
patternlength = 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquot + 60 + pattquot
}    
};
 
		function startVibrate(level) {
			navigator.vibrate(level);
		}
		var vibrateInterval;
		function startPeristentVibrate(level, interval) {
			vibrateInterval = setInterval(function() {
				startVibrate(level);
			}, interval);
		}
		
		function stopVibrate() {
			if(vibrateInterval) clearInterval(vibrateInterval);
			navigator.vibrate([]);
		}  		
	
  $(page)
    .find('#startbutton')
    .on('click', function () {
if (ruready == 1) {
   $(page).find('#replaybutton').removeClass('app-button').text(''); 		
pulsfrequenz()
pulspattern()
startPeristentVibrate(vibrpattern, patternlength);
   $(page).find('.feld1').text(" ");
   $(page).find('.feld2').text("... Puls端bung startet ...");
   $(page).find('.feld3').text(" ");
   $(page).find('.feld4').text(" ");
ruready = 0
}
else {
	return false}
   });
	
	
  $(page)
    .find('#stopbutton')
    .on('click', function () {
initApp();	  
ruready = 1;	  
stopVibrate();
   $(page).find('.feld1').text('Pulsfrequenz: ' + pf + ' 1/min');
   $(page).find('.feld2').text('' + pfrequenz + '');  
   $(page).find('.feld3').text('Pulsrhythmus: ' + prhythmus + '').css('font-weight', 'bold');
   $(page).find('.feld4').text('' + pascii + '');
   $(page).find('.feld4').text('' + pascii + '');	  
   $(page).find('#replaybutton').addClass('app-button blue').text('Noch einmal abspielen?'); 
   });
	
  $(page)
    .find('#replaybutton')
    .on('click', function () {
if (ruready == 1) {	  
startPeristentVibrate(vibrpattern, patternlength);
ruready = 2
}
else {
	return false}	
   });	
	    
$(page)
    .find('#weblink')
    .on('click', function () {

        window.open($(this).attr("href"))
});
	   });
      try {
        App.restore();
      } catch (err) {
        App.load('home');
      }
	    
	     
    </script>
  </body>
</html>
